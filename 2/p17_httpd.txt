
아파치 서버 설정

1.
user    : main
skel    : /ghd/
자동생성 디렉터리   : public_html/
DocumentRoot       : ~main/public_html/

www.2bwithu.co.kr   : 화면 내용 main

2.
www.2bwithu.co.kr/test1   : 화면 내용 test1

3.
www.2bwithu.co.kr/test1/test2   : 화면 내용 test2

4.
www.2bwithu.co.kr/~user1   : user1 홈 디렉터리 내부 index.html

5.
www.2bwithu.co.kr/user2/   : user2 홈 디렉터리 내부 index.html


1~5 까지의 문제는 순서대로 진행
2,3번 문제는 httpd.conf 설정 파일 사용 안하기.(FQDN 을 DocumentRoot 로 바꿔서 보는것을 권장)
4,5번 문제는 httpd.conf 설정 파일의 마지막 줄 참조(파일 4개 중 하나는 4번, 하나는 5번과 관련됨.)


문제 해결 :
큰 맥락은 다음과 같습니다.

1. DNS 설정
    1-0. yum , named.conf 설정
    1-1. /etc/named.rfc1912.zones 설정에서 zone 추가
    1-2. 추가해준 zone 영역에 대한 파일 생성 및 내용 추가
    1-3. 파일들  권한 설정
    + resolv.conf 파일 내용 확인 및 데몬 재시작
2. HTTP 설정
    2-0. yum

시작하겠습...다.

yum -y install bind-* httpd-*
로 named 서비스와 httpd 서비스에 관련한 패키지 다운로드

vi /etc/named.rfc1912.zones
열어서

options { 아래에
listen-on port 53 { any; };
allow-query     { any; };
으로 바꾸기

vi /etc/named.rfc1912.zones
열고, 파일 말단에


zone "2bwithu.co.kr" IN {
        type master;
        file "2b.zone";
        allow-update {any;};
        allow-transfer {any;};
};

zone "127.168.192.in-addr.arpa" IN {
        type master;
        file "2b.rev";
        allow-update {any;};
        allow-transfer {any;};
};

추가하기

cd /var/named
로 이동
cp named.localhost 2b.zone
cp named.localhost 2b.rev

로 zone들에 적어놨던 파일 생성

아래의 출력문은 잘 나와야한다.
[root@server named]# ll 2b*
-rw-r--r-- 1 root root 152 12월 29 05:20 2b.rev
-rw-r----- 1 root root 152 12월 29 05:21 2b.zone
[root@server named]#

vi 2b.zone
으로 파일 열고

$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

www     IN      A       192.168.127.128
이런식으로 내용을 바꾼다.
(*출력문은 다음과 같다.
[root@server named]#cat 2b.zone
$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

www     IN      A       192.168.127.128
[root@server named]#
)

vi 2b.rev
으로 파일 열고

$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

128     IN      PTR     www.2bwithu.co.kr.
(* 출력문은 다음과 같다.
[root@server named]# cat 2b.rev
$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

128     IN      PTR     www.2bwithu.co.kr.
[root@server named]# 
)

으로 내용을 바꾼다.

chmod 660 2b*
chown .named 2b*
으로 소유자와 권한을 바꾼다.

systemctl restart named
로 데몬을 재실행함과 동시에 정상작동 여부 확인

vi /etc/resolv.conf
로 열어서

# Generated by NetworkManager
nameserver 192.168.127.128
nameserver 192.168.127.2
첫번째 도메인(FQDN)검색 대상을 '나'로 지정

nslookup 을 친 다음
www.2bwithu.co.kr 와
192.168.127.128 을 입력해서 정상 작동 여부 확인 











2.HTTP

skel 작업 시작.
mkdir /ghd
cp -r /etc/skel /ghd
mkdir /ghd/public_html


유저 설정 작업 시작.
useradd -mk /ghd user1
useradd -mk /ghd user2
useradd -mk /ghd main

공동 '실행'을 위해서 main 의 홈디렉터리는 701로 권한재설정
chmod 701 ~main

echo "main's home" >> ~main/public_html/index.html


vi /etc/httpd/conf/httpd.conf
로 httpd 설정 파일 열고

119번행 즈음에 있는
DocumentRoot "/var/www/html"
을
DocumentRoot "/home/main/public_html"
로 바꾸기

밑에있는 옵션도 바꾸기

# Relax access to content within /var/www.
#
<Directory "/var/www">
    AllowOverride None
    # Allow open access:
    Require all granted
</Directory>
에서

<Directory "/var/www">
를
<Directory "/home/main">
으로 바꾸기

그 밑에 있는
# Further relax access to the default document root:
<Directory "/var/www/html">
도
# Further relax access to the default document root:
<Directory "/home/main/public_html">
으로 바꾸기

저장하고 나온다.





cd ~main/public_html
로 이동

mkdir test1
echo "directory test1" >> test1/index.html
로 index 파일 생성

mkdir /home/main/public_html/test1/test2
디렉터리 생성
echo "directory test2" >> ./test1/test2/index.html
index.html 생성





tail -1 /etc/httpd/conf/httpd.conf
라고 입력해서 우리가 찾아봐야하는 유틸리티 파일의 경로가 어디인지 출력하기

IncludeOptional conf.d/*.conf
라고 출력되면, 실질적인 경로가
/etc/httpd/conf.d
가 되므로

cd /etc/httpd/conf.d
로 이동

일단 user1 이랑 user2의 홈 디렉터리를 'apache 가 사용할 수 있도록' 권한을 설정해줌

chmod 701 ~user1
echo "user1's home" >> ~user1/public_html/index.html
으로 홈 디렉터리에 index.html 넣고

vi /etc/httpd/conf.d/userdir.conf

"UserDir disabled"
를 주석처리하고, 다음줄인
#UserDir public_html
의 주석처리를 풀라는 내용입니다.
아래는 이 파일의 수정 후 전체 내용입니다.
[root@server conf.d]# cat /etc/httpd/conf.d/userdir.conf
#
# UserDir: The name of the directory that is appended onto a user's home
# directory if a ~user request is received.
#
# The path to the end user account 'public_html' directory must be
# accessible to the webserver userid.  This usually means that ~userid
# must have permissions of 711, ~userid/public_html must have permissions
# of 755, and documents contained therein must be world-readable.
# Otherwise, the client will only receive a "403 Forbidden" message.
#
<IfModule mod_userdir.c>
    #
    # UserDir is disabled by default since it can confirm the presence
    # of a username on the system (depending on home directory
    # permissions).
    #
    #UserDir disabled

    #
    # To enable requests to /~user/ to serve the user's public_html
    # directory, remove the "UserDir disabled" line above, and uncomment
    # the following line instead:
    #
    UserDir public_html
</IfModule>

#
# Control access to UserDir directories.  The following is an example
# for a site where these directories are restricted to read-only.
#
<Directory "/home/*/public_html">
    AllowOverride FileInfo AuthConfig Limit Indexes
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    Require method GET POST OPTIONS
</Directory>

[root@server conf.d]#


systemctl restart httpd
로 httpd 데몬 재실행

chmod 701 ~user2
echo "user2's home d" >> ~user2/public_html/index.html

vi autoindex.conf
열고

Alias /icons/ "/usr/share/httpd/icons/"

<Directory "/usr/share/httpd/icons">
    Options Indexes MultiViews FollowSymlinks
    AllowOverride None
    Require all granted
</Directory>

여기 문단 찾아서, 밑에

Alias /user2/ "/home/user2/public_html/"

<Directory "/home/user2/public_html">
    Options Indexes MultiViews FollowSymlinks
    AllowOverride None
    Require all granted
</Directory>

이렇게 추가하기
