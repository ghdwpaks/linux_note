
아파치 서버 설정

1.
user    : main
skel    : /ghd/
자동생성 디렉터리   : public_html/
DocumentRoot       : ~main/public_html/

www.2bwithu.co.kr   : 화면 내용 main

2.
www.2bwithu.co.kr/test1   : 화면 내용 test1

3.
www.2bwithu.co.kr/test1/test2   : 화면 내용 test2

4.
www.2bwithu.co.kr/~user1   : user1 홈 디렉터리 내부 index.html

5.
www.2bwithu.co.kr/user2/   : user2 홈 디렉터리 내부 index.html


1~5 까지의 문제는 순서대로 진행
2,3번 문제는 httpd.conf 설정 파일 사용 안하기.(FQDN 을 DocumentRoot 로 바꿔서 보는것을 권장)
4,5번 문제는 httpd.conf 설정 파일의 마지막 줄 참조(파일 4개 중 하나는 4번, 하나는 5번과 관련됨.)


문제 해결 :
큰 맥락은 다음과 같습니다.

1. DNS 설정
    1-0. yum , named.conf 설정
    1-1. /etc/named.rfc1912.zones 설정에서 zone 추가
    1-2. 추가해준 zone 영역에 대한 파일 생성 및 내용 추가
    1-3. 파일들  권한 설정
    + resolv.conf 파일 내용 확인 및 데몬 재시작
2. HTTP 설정
    2-0. yum

시작하겠습...다.

yum -y install bind-* httpd-*
로 named 서비스와 httpd 서비스에 관련한 패키지 다운로드

vi /etc/named.rfc1912.zones
열어서

options { 아래에
listen-on port 53 { any; };
allow-query     { any; };
으로 바꾸기

vi /etc/named.rfc1912.zones
열고, 파일 말단에


zone "2bwithu.co.kr" IN {
        type master;
        file "2b.zone";
        allow-update {any;};
        allow-transfer {any;};
};

zone "127.168.192.in-addr.arpa" IN {
        type master;
        file "2b.rev";
        allow-update {any;};
        allow-transfer {any;};
};

추가하기

cd /var/named
로 이동
cp named.localhost 2b.zone
cp named.localhost 2b.rev

로 zone들에 적어놨던 파일 생성

아래의 출력문은 잘 나와야한다.
[root@server named]# ll 2b*
-rw-r--r-- 1 root root 152 12월 29 05:20 2b.rev
-rw-r----- 1 root root 152 12월 29 05:21 2b.zone
[root@server named]#

vi 2b.zone
으로 파일 열고

$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

www     IN      A       192.168.127.128
이런식으로 내용을 바꾼다.
(*출력문은 다음과 같다.
[root@server named]#cat 2b.zone
$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

www     IN      A       192.168.127.128
[root@server named]#
)

vi 2b.rev
으로 파일 열고

$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

128     IN      PTR     www.2bwithu.co.kr.
(* 출력문은 다음과 같다.
[root@server named]# cat 2b.rev
$TTL 1D
@       IN SOA  2bwithu.co.kr.          root(
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        IN      NS      2bwithu.co.kr.
        IN      A       192.168.127.128

128     IN      PTR     www.2bwithu.co.kr.
[root@server named]# 
)

으로 내용을 바꾼다.

chmod 660 2b*
chown .named 2b*
으로 소유자와 권한을 바꾼다.

systemctl restart named
로 데몬을 재실행함과 동시에 정상작동 여부 확인

vi /etc/resolv.conf
로 열어서

# Generated by NetworkManager
nameserver 192.168.127.128
nameserver 192.168.127.2
첫번째 도메인(FQDN)검색 대상을 '나'로 지정

nslookup 을 친 다음
www.2bwithu.co.kr 와
192.168.127.128 을 입력해서 정상 작동 여부 확인 











2.HTTP

skel 작업 시작.
mkdir /ghd
cp -r /etc/skel /ghd
mkdir /ghd/public_html


유저 설정 작업 시작.
useradd -mk /ghd user1
useradd -mk /ghd user2
useradd -mk /ghd main

공동 '실행'을 위해서 main 의 홈디렉터리는 701로 권한재설정
chmod 701 ~main

echo "main's home" >> ~main/public_html/index.html


vi /etc/httpd/conf/httpd.conf
로 httpd 설정 파일 열고

119번행 즈음에 있는
DocumentRoot "/var/www/html"
을
DocumentRoot "/home/main/public_html"
로 바꾸기

밑에있는 옵션도 바꾸기

# Relax access to content within /var/www.
#
<Directory "/var/www">
    AllowOverride None
    # Allow open access:
    Require all granted
</Directory>
에서

<Directory "/var/www">
를
<Directory "/home/main">
으로 바꾸기

그 밑에 있는
# Further relax access to the default document root:
<Directory "/var/www/html">
도
# Further relax access to the default document root:
<Directory "/home/main/public_html">
으로 바꾸기

저장하고 나온다.

